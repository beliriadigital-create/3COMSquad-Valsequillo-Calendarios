<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3COM Squad Valsequillo</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #b01c68;
            --dark: #4a1033;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 10px;
            color: white;
            background: #4a1033 url('fondo.png') no-repeat center center fixed;
            background-size: cover;
        }

        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            z-index: -1;
        }

        .header {
            text-align: center;
            padding: 10px;
        }

        .logo {
            max-width: 70px;
        }

        /* ===== CONTENEDOR CATEGOR√çAS (HORIZONTAL) ===== */
        #lista-categorias {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            align-items: flex-start;
        }

        .categoria-bloque {
            width: 100%;
            max-width: 400px;
        }

        /* ===== DESTACADO ===== */
        .destacado {
            background: white;
            color: #333;
            border-radius: 20px;
            padding: 15px;
            max-width: 380px;
            margin: 0 auto 20px;
            text-align: center;
            border-left: 8px solid var(--primary);
        }

        .res-dest {
            background: var(--dark);
            color: white;
            font-size: 1.5rem;
            font-weight: 900;
            padding: 5px 15px;
            border-radius: 8px;
            display: inline-block;
            margin: 8px 0;
        }

        /* ===== CABECERA CATEGOR√çA ===== */
        .cat-header {
            background: var(--primary);
            padding: 8px 12px;
            font-weight: 900;
            border-radius: 10px 10px 0 0;
            font-size: 0.7rem;
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-transform: uppercase;
        }

        .btn-cal {
            background: white;
            color: var(--primary);
            padding: 3px 8px;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.6rem;
            font-weight: 900;
        }

        /* ===== CARRUSEL ===== */
        .carousel {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 0 0 10px 10px;
            -webkit-overflow-scrolling: touch;
        }

        /* ===== TARJETA PARTIDO ===== */
        .card {
            background: white;
            color: #333;
            min-width: 180px;
            width: 180px;
            padding: 12px;
            border-radius: 10px;
            flex-shrink: 0;
            text-align: center;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            overflow: hidden;
        }

        .p-fecha {
            font-weight: 800;
            color: var(--primary);
            font-size: 0.7rem;
            margin-bottom: 8px;
            border-bottom: 1px solid #eee;
            padding-bottom: 3px;
        }

        .p-equipos {
            font-weight: 700;
            font-size: 0.65rem;
            text-transform: uppercase;
            line-height: 1.4;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .p-res {
            background: var(--dark);
            color: white;
            margin-top: 8px;
            padding: 4px;
            border-radius: 6px;
            font-weight: 900;
            font-size: 0.8rem;
        }

        /* ‚úÖ FIX DEFINITIVO DEL PABELL√ìN */
        .p-lugar {
            font-size: 0.55rem;
            color: #666;
            margin-top: 5px;
            font-style: italic;
            line-height: 1.2;
            text-align: center;

            max-width: 100%;
            white-space: normal;
            word-break: break-word;
            overflow-wrap: anywhere;
            hyphens: auto;
        }

        @media (max-width: 600px) {
            .categoria-bloque {
                max-width: 100%;
            }
        }
    </style>
</head>

<body>

    <div class="header">
        <img src="logo.png" class="logo">
    </div>

    <div id="destacado-container"></div>

    <div id="lista-categorias"></div>

    <script>
        // ========== FUNCIONES AUXILIARES ==========

        // 1Ô∏è‚É£ Abreviar pabellones
        function abreviarPabellon(txt) {
            if (!txt) return '';
            return txt
                .replace(/PABELLON/gi, 'PAB.')
                .replace(/MUNICIPAL/gi, 'MUN.')
                .replace(/INSULAR/gi, 'INS.')
                .replace(/\s+/g, ' ')
                .trim();
        }

        // 2Ô∏è‚É£ Icono casa/fuera
        function iconoCasaFuera(local, visitante) {
            const club = 'valsequillo';
            const l = (local || '').toLowerCase();
            const v = (visitante || '').toLowerCase();
            if (l.includes(club)) return 'üè†';
            if (v.includes(club)) return 'üöå';
            return '';
        }

        // 3Ô∏è‚É£ Parsear fecha para ordenar
        function parseFecha(fecha) {
            if (!fecha || !fecha.includes('/')) return null;
            try {
                const partes = fecha.split('|');
                const [dd, mm, yyyy] = partes[0].trim().split('/');
                const tiempo = partes[1] ? partes[1].trim().split(':') : ['00', '00'];
                const [hh, mi] = tiempo;
                return new Date(yyyy, mm - 1, dd, hh, mi);
            } catch (e) {
                return null;
            }
        }

        // ========== CARGA Y RENDERIZADO ==========

        async function cargar() {
            const res = await fetch('categories.json?v=' + Date.now());
            const cats = await res.json();

            let todos = [];

            for (const c of cats) {
                try {
                    const rp = await fetch(`./${c.slug}/partidos.json?v=` + Date.now());
                    const data = await rp.json();

                    if (data.matches && data.matches.length > 0) {
                        
                        // 3Ô∏è‚É£ ORDENAR POR FECHA (pr√≥ximos primero, sin fecha al final)
                        data.matches.sort((a, b) => {
                            const fa = parseFecha(a.fecha_texto);
                            const fb = parseFecha(b.fecha_texto);
                            if (!fa && !fb) return 0;
                            if (!fa) return 1;
                            if (!fb) return -1;
                            return fa - fb;
                        });

                        let cards = '';

                        data.matches.forEach(m => {
                            todos.push({...m, cat: c.name});

                            const icono = iconoCasaFuera(m.local, m.visitante);
                            const lugarAbrev = abreviarPabellon(m.lugar);

                            cards += `
                                <div class="card">
                                    <div class="p-fecha">${icono} ${m.fecha_texto}</div>
                                    <div class="p-equipos">
                                        <div>${m.local}</div>
                                        <div style="color:#999;font-size:0.55rem;">VS</div>
                                        <div>${m.visitante}</div>
                                    </div>
                                    <div class="p-res">${m.resultado || 'PR√ìXIMO'}</div>
                                    <div class="p-lugar">üìç ${lugarAbrev}</div>
                                </div>`;
                        });

                        document.getElementById('lista-categorias').innerHTML += `
                            <div class="categoria-bloque">
                                <div class="cat-header">
                                    <span>${c.name}</span>
                                    <a href="./${c.slug}/calendar.ics" class="btn-cal">CALENDARIO</a>
                                </div>
                                <div class="carousel">${cards}</div>
                            </div>`;
                    }
                } catch (e) {}
            }

            // ========== DESTACADO (pr√≥ximo partido sin resultado) ==========
            if (todos.length > 0) {
                // Ordenar todos los partidos por fecha
                todos.sort((a, b) => {
                    const fa = parseFecha(a.fecha_texto);
                    const fb = parseFecha(b.fecha_texto);
                    if (!fa && !fb) return 0;
                    if (!fa) return 1;
                    if (!fb) return -1;
                    return fa - fb;
                });

                // Buscar el pr√≥ximo partido (sin resultado o sin marcador tipo "X-Y")
                const p = todos.find(m => !m.resultado || !m.resultado.includes('-')) || todos[0];

                const iconoDestacado = iconoCasaFuera(p.local, p.visitante);
                const lugarDestacado = abreviarPabellon(p.lugar);

                // --------- Aqu√≠ la mejora: mostramos "PR√ìXIMO" si no hay resultado v√°lido
                const textoResultadoDestacado = (p.resultado && p.resultado !== 'VS') ? p.resultado : 'PR√ìXIMO';

                document.getElementById('destacado-container').innerHTML = `
                    <div class="destacado">
                        <div style="color:var(--primary);font-weight:900;font-size:0.6rem;text-transform:uppercase;">
                            ${p.cat}
                        </div>
                        <div style="font-size:0.8rem;font-weight:700;margin-top:5px;">
                            ${iconoDestacado} üóìÔ∏è ${p.fecha_texto}
                        </div>
                        <h3 style="font-size:0.9rem;margin:10px 0;text-transform:uppercase;">
                            ${p.local}<br>
                            <span style="color:#999;font-size:0.7rem;">vs</span><br>
                            ${p.visitante}
                        </h3>
                        <div class="res-dest">${textoResultadoDestacado}</div>
                        <div style="font-size:0.65rem;color:#666;">üìç ${lugarDestacado}</div>
                    </div>`;
            }
        }

        cargar();
    </script>

</body>
</html>
