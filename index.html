<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calendarios - 3COM Squad Valsequillo</title>
  <style>
    :root{
      --pink:#ff2aa6;
      --pink2:#ff5cc3;
      --bg:#0b0b12;
      --card: rgba(255,255,255,.92);
      --muted:#6b7280;
      --shadow: 0 14px 40px rgba(0,0,0,.25);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:#111827;
      background:
        linear-gradient(180deg, rgba(11,11,18,.75), rgba(11,11,18,.90)),
        url("./assets/bg-pink-sport.png") center/cover no-repeat fixed;
      min-height:100vh;
    }
    .wrap{max-width:1000px;margin:0 auto;padding:18px}
    
    /* Cabecera Principal */
    .header-main{
      text-align:center;padding:30px 0;color:#fff;
    }
    .logo-main{
      width:100px;height:100px;margin:0 auto 15px;
      background:#fff;border-radius:20px;padding:8px;
      box-shadow: 0 10px 30px rgba(255,42,166,.3);
    }
    .logo-main img{width:100%;height:100%;object-fit:contain}
    .header-main h1{margin:0;font-size:1.8rem;font-weight:900;text-transform:uppercase;letter-spacing:1px}
    
    /* Secci贸n de Categor铆a */
    .cat-section{margin-bottom:50px}
    .cat-header{
      display:flex;align-items:center;justify-content:space-between;
      padding:15px;background:rgba(255,255,255,.1);
      backdrop-filter:blur(10px);border-radius:var(--radius);
      border:1px solid rgba(255,255,255,.15);margin-bottom:15px;color:#fff;
    }
    .cat-header h2{margin:0;font-size:1.4rem;font-weight:800}
    
    .btn-ics{
      background:linear-gradient(135deg, var(--pink), var(--pink2));
      color:#fff;text-decoration:none;padding:10px 16px;
      border-radius:12px;font-weight:800;font-size:.9rem;
      box-shadow: 0 8px 20px rgba(255,42,166,.3);
      transition:transform .1s;
    }
    .btn-ics:hover{transform:scale(1.03)}

    /* Grid de Partidos */
    .grid{
      display:grid;grid-template-columns:1fr;gap:15px;
    }
    @media (min-width: 768px){ .grid{grid-template-columns:1fr 1fr} }

    /* Tarjetas */
    .card{
      background:var(--card);border-radius:var(--radius);
      box-shadow:var(--shadow);position:relative;overflow:hidden;
      border:1px solid rgba(0,0,0,.05);
    }
    .card::before{
      content:"";position:absolute;left:0;top:0;bottom:0;width:6px;
      background:rgba(0,0,0,.1);
    }
    .card.home::before{background:var(--pink)}
    .card-inner{padding:15px 15px 15px 20px}
    
    .row-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}
    .date{font-weight:900;font-size:1rem;color:#111827}
    .status{font-size:.85rem;font-weight:700;color:var(--muted)}
    .badge{
      font-size:.75rem;font-weight:900;padding:5px 10px;
      border-radius:20px;background:rgba(0,0,0,.05);
    }
    .badge.home{background:rgba(255,42,166,.1);color:var(--pink)}
    
    .teams{font-weight:900;font-size:1.1rem;margin:10px 0;line-height:1.3}
    .vs{color:var(--pink);font-size:.9rem;margin:0 5px}
    
    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:10px;font-size:.85rem}
    .place{font-weight:800;color:#b42318}
    .score{background:#111827;color:#fff;padding:4px 10px;border-radius:8px;font-weight:900}

    .loading{color:#fff;text-align:center;padding:20px;font-weight:700}
  </style>
</head>
<body>

  <div class="wrap">
    <header class="header-main">
      <div class="logo-main">
        <img src="./assets/LOGO-3COM-SQUAD-2022-1.png" alt="Logo">
      </div>
      <h1>Calendarios Oficiales</h1>
      <p style="color:rgba(255,255,255,.7)">3COM Squad Valsequillo 路 Temporada 25/26</p>
    </header>

    <div id="master-container">
      <div class="loading">Cargando todas las categor铆as...</div>
    </div>
  </div>

  <script>
    const container = document.getElementById('master-container');

    async function loadAll() {
      try {
        const res = await fetch('./categories.json');
        const categories = await res.json();
        container.innerHTML = '';

        for (const cat of categories) {
          const section = document.createElement('section');
          section.className = 'cat-section';
          
          // Crear cabecera de secci贸n
          section.innerHTML = `
            <div class="cat-header">
              <h2>${cat.title}</h2>
              <a href="./${cat.slug}/calendario.ics" class="btn-ics"> Suscribirse</a>
            </div>
            <div id="grid-${cat.slug}" class="grid"><div class="loading">Cargando partidos...</div></div>
          `;
          container.appendChild(section);

          // Cargar partidos de esta categor铆a
          fetch(`./${cat.slug}/partidos.json`)
            .then(r => r.json())
            .then(data => {
              const grid = document.getElementById(`grid-${cat.slug}`);
              grid.innerHTML = '';
              
              if (!data.matches || data.matches.length === 0) {
                grid.innerHTML = '<div class="loading">No hay partidos programados.</div>';
                return;
              }

              data.matches.forEach(m => {
                const isHome = m.es_casa;
                const scoreMatch = (m.estado || "").match(/(\d+)\s*[-:]\s*(\d+)/);
                const scoreHtml = scoreMatch ? `<div class="score">${scoreMatch[0]}</div>` : '';
                
                const card = document.createElement('div');
                card.className = `card ${isHome ? 'home' : ''}`;
                card.innerHTML = `
                  <div class="card-inner">
                    <div class="row-top">
                      <div>
                        <div class="date">${m.fecha_texto}</div>
                        <div class="status">${m.estado || 'Pendiente'}</div>
                      </div>
                      <div class="badge ${isHome ? 'home' : ''}">${isHome ? 'CASA' : 'FUERA'}</div>
                    </div>
                    <div class="teams">
                      ${m.local} <span class="vs">vs</span> ${m.visitante}
                    </div>
                    <div class="footer">
                      <div class="place"> ${m.lugar}</div>
                      ${scoreHtml}
                    </div>
                  </div>
                `;
                grid.appendChild(card);
              });
            })
            .catch(() => {
              document.getElementById(`grid-${cat.slug}`).innerHTML = '<div class="loading">Pendiente de actualizaci贸n.</div>';
            });
        }
      } catch (e) {
        container.innerHTML = '<div class="loading">Error al cargar las categor铆as.</div>';
      }
    }

    loadAll();
  </script>
</body>
</html>
